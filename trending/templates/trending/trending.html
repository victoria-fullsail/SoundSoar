{% extends 'core/base.html' %}
{% load static %}

{% block content %}
<div class="container mt-5">

    <!-- Dropdown for selecting charts -->
    <div class="mb-3">
        <label for="chart-select" class="form-label">Select Chart:</label>
        <select id="chart-select" class="form-select" onchange="location = this.value;">
            <option value="">-- Choose a Chart --</option>
            {% for chart in all_charts %}
                <option value="{% url 'trending:trending_filtered' chart_type=chart.chart_type chart_name=chart.name %}"
                    {% if chart.name == request.GET.chart_name %} selected{% endif %}>
                    {{ chart.name }}
                </option>
            {% endfor %}
        </select>
    </div>

    <!-- Track Popularity Vizualization -->
    <h2>Interactive Tracks Visualization</h2>
    {{ bokeh_div|safe }}
    {{ bokeh_script|safe }}

    <!-- Track Table -->
    {% if track_data %}
        <div class="table-responsive">
            <table id="trackTable" class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>Track Name</th>
                        <th>Artist</th>
                        <th>Current Trend</th>
                        <th>Action</th> <!-- New Action Column -->
                    </tr>
                </thead>
                <tbody>
                    {% for track, feature in track_data %}
                        <tr>
                            <td>{{ track.name }}</td>
                            <td>{{ track.artist }}</td>
                            <td>{% if feature %}{{ feature.trend }}{% else %}N/A{% endif %}</td>
                            <td>
                                <a class="btn btn-secondary" href="{% url 'trending:track_detail' track.id %}">View Details</a>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p>No tracks available for this playlist.</p>
    {% endif %}
</div>

<!-- Include DataTables CSS and JS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
<link href="https://cdn.bokeh.org/bokeh/release/bokeh-2.4.2.min.css" rel="stylesheet" type="text/css">
<script src="https://cdn.bokeh.org/bokeh/release/bokeh-2.4.2.min.js"></script>


<!-- Initialize DataTables -->
<script>
    $(document).ready(function() {
        $('#trackTable').DataTable({
            "paging": true,   // Enable pagination
            "ordering": true, // Enable sorting
            "info": true,     // Show table info
            "searching": true  // Enable searching/filtering
        });
    });
</script>

<!-- Include Bootstrap CSS and JS -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
<script src="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>

{% endblock content %}
